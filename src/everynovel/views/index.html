<!DOCTYPE html>
<html>
<head>
<title>Every Novel</title>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="static/plugins/layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="static/css/index.css">
</head>
<body>
<div id="head-wrap">
    <div id="head-container">
        <a href="" class="logo">
            <img src="static/images/logo.fw.png">
        </a>
        <ul class="layui-nav" lay-filter="">
            <li class="layui-nav-item layui-this"><a href="javascript:;">首页</a></li>
            <li class="layui-nav-item"><a href="javascript:;">发现</a></li>
            <li class="layui-nav-item"><a href="javascript:;">导航菜单</a></li>
        </ul>
        <div class="userinfo">
            <div class="al" v-if="isLogin">
                <span class="al-name">{{username}}</span>
                <span class="al-btn" @click="create_new()">创建新开篇</span>
                <span class="al-btn" @click="read_last()">继续上次阅读</span>
            </div>
            <div class="bl" v-else>
                <span class="bl-tips">登录后继续阅读</span>
                <span class="bl-btn" @click="show_reg()">注册</span>
                <span class="bl-btn" @click="show_log()">登陆</span>
            </div>
        </div>
    </div>
</div>
<div id="main-wrap">
    <div id="main-container">
        <div v-if="last.length" class="read">
            <div class="title"><i class="layui-icon">&#xe603;</i>{{last[0].title}}</div>
            <p v-for="(v,k) in last">{{v.content}}</p>
        </div>
        <div v-if="item" class="curr">
            
        </div>
        <div class="item" v-for="(v,k) in list" :data-i="k" :data-id="v.id">
            <div class="word" @click="word_click()">{{v.content}}</div>
            <div class="info">
                <img class="avatar" src="static/images/100.gif">
                <span>Hello&nbsp;在&nbsp;<i>{{v.date}}</i>&nbsp;发起了新开篇&nbsp;<i>{{v.title}}</i></span>
                <div class="option">
                    <span>续创99次</span>
                    <span>点赞99次</span>
                    <span>阅读99次</span>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="foot-wrap">
    <div id="foot-container">
        <div class="copyright">&copy;&nbsp;Copyright&nbsp;-&nbsp;www.everynovel.com</div>
    </div>
</div>
<!-- 弹窗 -->
<div id="popups-create" class="popups">
    <form class="layui-form" onsubmit="return false">
        <input type="hidden" name="pid" value="">
        <div class="layui-form-item">
            <label class="layui-form-label">标题</label>
            <div class="layui-input-block">
                <input type="text" name="title" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">内容</label>
            <div class="layui-input-block">
                <textarea name="content" placeholder="请输入内容" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="formDemo" onclick="create_word()">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>
</body>
<script type="text/javascript" src="static/js/config.js"></script>
<script type="text/javascript" src="static/js/jquery.min.js"></script>
<script type="text/javascript" src="static/plugins/layui/layui.js"></script>
<script type="text/javascript" src="static/js/vue.js"></script>
<script type="text/javascript">
/*layui*/
layui.use('element', function(){
    var element = layui.element();
});
layui.use('layer', function(){
    var layer = layui.layer;
});
layui.use('form', function(){
    var form = layui.form();
});

/*vuejs*/
var HeadData = new Vue({
    el: '#head-container',
    data: {
        isLogin : 0,
        username : 'Lisi'
    },
    methods: {
        show_log : function(){
            this.isLogin = 1;
        },
        show_reg : function(){},
        create_new : function(){
            layer.open({
                type: 1,
                title: false,
                closeBtn: 1,
                shadeClose: true,
                resize: false,
                area: '500px',
                // skin: 'yourclass',
                content: $('#popups-create')
            });
        },
        read_last : function(){},
    }
})

var MainData = new Vue({
    el: '#main-container',
    data: {
        list : [],
        last : [],
        item : '',
        // title : '',
        // model : 0,
    },
    methods: {
        word_click: function(){
            var t = event.currentTarget;
            var p = $(t).parent('.item');

            var ii = $(p).data('i');
            var id = $(p).data('id')

            // $(t).parent('.item').siblings().fadeOut();
            this.item = this.list[ii];
            this.last.push(this.item);

            $('#popups-create form input[name="pid"]').val(id);
            data(id);
        }
    }
})

$(document).ready(function(){
    init_layout();
    data();
});

$(window).scroll(function(){
    var s = $(window).scrollTop();
    if(s>20){
        $('#head-wrap').addClass('scroll');
    }else{
        $('#head-wrap').removeClass('scroll');
    }
})

function init_layout(){
    var w = $(window).width();
    var h = $(window).height();

    var h_h = $('#head-container').height();
    var h_f = $('#foot-container').height();

    $('#main-container').css('min-height',h-h_h-h_f-20);
}

function data(id){
    console.log(id);
    $.ajax({
        type: "GET",
        url: "/GetWord",
        data: {id:id},
        timeout : 6000,
        dataType: "JSON",
        beforeSend: function(xhr){
            // do something
        },
        success: function (data) {
            console.log(data);
            MainData.list = data.Data;
        },
        error: function(xhr,msg){
            alert('ERROR : '+msg);
        },
        complete: function(){
            // do something
        }
    });
}

function create_word(id){
    $.ajax({
        type: "POST",
        url: "/PostWord",
        data: $('#popups-create form').serialize(),
        timeout : 6000,
        dataType: "JSON",
        beforeSend: function(xhr){
            // do something
        },
        success: function (data) {
            console.log(data);
        },
        error: function(xhr,msg){
            alert('ERROR : '+msg);
        },
        complete: function(){
            // do something
        }
    });
}
</script>
</html>